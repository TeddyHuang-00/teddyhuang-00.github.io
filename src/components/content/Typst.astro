---
import { NodeCompiler } from "@myriaddreamin/typst-ts-node-compiler";

export interface Props {
  filePath: string;
  workspace?: string;
  fontPaths?: string[];
  caption?: string;
}

const {
  filePath,
  workspace = "src/assets/images",
  fontPaths = [".cache/fonts"],
  caption,
} = Astro.props;
const compiler = NodeCompiler.create({
  workspace,
  fontArgs: [{ fontPaths }],
});
const lightSvg = compiler.svg({
  mainFilePath: filePath,
  inputs: {
    theme: "light",
  },
});
const darkSvg = compiler.svg({
  mainFilePath: filePath,
  inputs: {
    theme: "dark",
  },
});
const notThemed = lightSvg === darkSvg;
---

{
  notThemed ? (
    <figure>
      <Fragment set:html={lightSvg} />
      {caption && <figcaption class="text-center">{caption}</figcaption>}
    </figure>
  ) : (
    <>
      <figure class="block dark:hidden">
        <Fragment set:html={lightSvg} />
        {caption && <figcaption class="text-center">{caption}</figcaption>}
      </figure>
      <figure class="hidden dark:block">
        <Fragment set:html={darkSvg} />
        {caption && <figcaption class="text-center">{caption}</figcaption>}
      </figure>
    </>
  )
}

<style is:global>
  .typst-doc {
    @apply mx-auto max-w-full;
  }
</style>
