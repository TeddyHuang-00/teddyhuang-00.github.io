---
/*
 * Copyright (c) 2023, Astro contributors.
 * SPDX-License-Identifier: MIT.
 *
 * File: Steps.astro
 * Modified: 2025-08-30
 * Description: Customize UI
 */
import { processSteps } from "./rehype-steps";

const content = await Astro.slots.render("default");
const { html } = processSteps(content);
---

<Fragment set:html={html} />

<style is:global>
  .sl-steps {
    /* Bullet size based on line-height (1.75 * 1rem = 1.75rem = 28px) */
    --bullet-size: 2rem;
    --bullet-margin: 0.5rem; /* 6px */

    list-style: none;
    padding-inline-start: 0;
    counter-reset: steps-counter var(--sl-steps-start, 0);

    > li {
      counter-increment: steps-counter;

      position: relative;
      padding-bottom: 1px;
      padding-inline-start: calc(var(--bullet-size) + 1rem);
      min-height: calc(var(--bullet-size) + var(--bullet-margin));

      /* Vertical alignment for first child in each step */
      > :first-child {
        --lh: calc(1em * 1.75); /* Based on --sl-line-height: 1.75 */
        @supports (--prop: 1lh) {
          --lh: 1lh;
        }
        --shift-y: calc(0.5 * (var(--bullet-size) - var(--lh)));
        transform: translateY(var(--shift-y));
        margin-bottom: var(--shift-y);
      }

      > :first-child:where(h1, h2, h3, h4, h5, h6) {
        --lh: calc(1em * 1.2); /* Based on --sl-line-height-headings: 1.2 */
      }
    }

    > li + li {
      margin-top: 0;
    }

    /* Numbered bullet styling */
    > li::before {
      position: absolute;
      top: 0;
      inset-inline-start: 0;
      font-size: 0.75rem;
      line-height: calc(1 / 0.75);
      font-weight: 600;
      text-align: center;
      border-radius: calc(infinity * 1px);
      background-color: var(--color-muted);
      color: var(--color-foreground);
      border: 1px solid var(--color-border);
      content: counter(steps-counter);
      width: var(--bullet-size);
      height: var(--bullet-size);
      line-height: var(--bullet-size);
    }

    /* Vertical connecting line */
    > li::after {
      content: "";
      position: absolute;
      width: 1px;
      background-color: var(--color-border);
      top: calc(var(--bullet-size) + var(--bullet-margin));
      bottom: calc(-1 * var(--bullet-margin));
      /* Center the line: (bullet-size - 1px) / 2 */
      inset-inline-start: calc((var(--bullet-size) - 1px) / 2);
    }

    /* Hide the connecting line on the last step */
    /* > li:last-child::after {
      display: none;
    } */
  }
</style>
